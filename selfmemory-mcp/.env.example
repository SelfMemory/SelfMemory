# SelfMemory MCP Server Configuration
# Copy this file to .env and update the values for your environment

# ====================================
# Core Configuration
# ====================================

# SelfMemory API Configuration
# This is where your core SelfMemory server is running
SELFMEMORY_API_HOST=http://127.0.0.1:8081

# MCP Server Configuration
# Host and port where the MCP server will listen for client connections
MCP_SERVER_HOST=0.0.0.0
MCP_SERVER_PORT=8080

# ====================================
# Ory Hydra OAuth 2.1 Configuration (REQUIRED)
# ====================================

# Hydra Admin URL (Required)
# Used by MCP server for token introspection
# For local development: http://127.0.0.1:4445
# For production: https://your-hydra-admin.example.com
HYDRA_ADMIN_URL=http://127.0.0.1:4445

# Hydra Public URL (Required)
# Used for OAuth discovery metadata
# For local development: http://127.0.0.1:4444
# For production: https://your-hydra-public.example.com
HYDRA_PUBLIC_URL=http://127.0.0.1:4444

# MCP Server URL (Required)
# This is YOUR server's URL that clients will connect to
# For local development: http://127.0.0.1:8080
# For production: https://your-mcp-server.example.com
MCP_SERVER_URL=http://127.0.0.1:8080

# Kratos URLs (Required - needed by server package imports)
# For local development
KRATOS_PUBLIC_URL=http://127.0.0.1:4433
KRATOS_ADMIN_URL=http://127.0.0.1:4434

# ====================================
# Optional Configuration
# ====================================

# Logging Configuration
# Set log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Development/Production Mode
# Set to true for development mode with additional logging
DEBUG=false

# ====================================
# OAuth 2.1 Flow Overview
# ====================================
# 1. Client discovers OAuth server via /.well-known/oauth-protected-resource
# 2. Client registers via dynamic client registration (automatic)
# 3. User authorizes via Hydra → Dashboard consent page
# 4. Dashboard sends project_id to Hydra in session data
# 5. Hydra issues token with ext.project_id claim
# 6. Client calls MCP with Bearer token
# 7. MCP validates token via HYDRA_ADMIN_URL
# 8. MCP extracts project_id from token claims
# 9. MCP forwards same token to core server
# 10. Core server validates token via Hydra
# 11. All memory operations are scoped to that project

# ====================================
# Client Usage
# ====================================
# When connecting MCP clients (like VS Code) to this server:
# 1. Server URL: http://localhost:8080/mcp
# 2. OAuth 2.1 will be used for authentication
# 3. User will be redirected to consent page to select project
# 4. Token will include project_id for scoped operations
#
# Example VS Code MCP configuration:
# {
#   "mcpServers": {
#     "selfmemory": {
#       "url": "http://localhost:8080/mcp",
#       "type": "sse"
#     }
#   }
# }

# ====================================
# Architecture Notes
# ====================================
# This MCP server implements OAuth 2.0 Protected Resource Metadata (RFC 9728)
# 
# Authentication Flow:
# - Client → MCP Server (OAuth token validated via Hydra)
# - MCP Server → Core Server (same OAuth token forwarded)
# - Core Server validates token via Hydra
#
# No API keys needed - single OAuth 2.1 authentication throughout
